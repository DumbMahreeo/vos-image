base: ghcr.io/vanilla-os/desktop:main
name: DumbMahreeo VanillaOS
id: dumbmahreeo-vos-custom
labels:
  maintainer: self-maintained
args:
  DEBIAN_FRONTEND: noninteractive

modules:
- name: init-setup
  type: shell
  commands:
  - lpkg --unlock
  - apt-get update

# BEGIN custom actions

- name: liquorix-kernel
  type: shell
  commands:
  - curl https://raw.githubusercontent.com/DumbMahreeo/vos-image/main/install-liquorix-vos.sh | sh

- name: onedriver
  type: shell
  commands:
  - echo 'deb http://download.opensuse.org/repositories/home:/jstaf/Debian_Unstable/ /' | tee /etc/apt/sources.list.d/home:jstaf.list
  - curl -fsSL https://download.opensuse.org/repositories/home:jstaf/Debian_Unstable/Release.key | gpg --dearmor | tee /etc/apt/trusted.gpg.d/home_jstaf.gpg > /dev/null
  - apt-get update
  - apt-get install -y onedriver

- name: apx-void
  type: shell
  commands:
  - apx pkgmanagers new -y -a 'xbps-remove --remove-orphans' -c 'xbps-remove --clean-cache' -l 'xbps-query -l' -i 'xbps-install' -n 'xbps' -S -p 'xbps-remove --recursive' -r 'xbps-remove' -s 'xbps-query --repository -s' -w 'xbps-query' -u 'xbps-install --sync' -U 'xbps-install --update'
  - apx stacks new -n void-glibc -b ghcr.io/void-linux/void-glibc-full:latest -k xbps -y

# END custom actions

- name: set-image-name-abroot
  type: includes
  includes:
    - modules/80-set-image-abroot-config

- name: cleanup
  type: shell
  commands:
  - apt-get autoremove -y
  - apt-get clean
  - lpkg --lock

- name: fsguard
  type: fsguard
  CustomFsGuard: false
  FsGuardLocation: "/usr/sbin/FsGuard"
  GenerateKey: true
  FilelistPaths: ["/usr/bin"]
  modules:
    - name: remove-prev-fsguard
      type: shell
      commands:
        - rm -rf /FsGuard 
        - rm -f ./minisign.pub ./minisign.key 
        - chmod +x /usr/sbin/init

- name: cleanup2
  type: shell
  commands:
    - rm -rf /tmp/*
    - rm -rf /var/tmp/*
    - rm -rf /sources
